function ubb2html(f){function o(h){return h!=null&&h!=""?!isNaN(h):false}var b=String(f),p=[],n=0;b=b.replace(/&/ig,"&amp;");b=b.replace(/[<>]/g,function(h){return{"<":"&lt;",">":"&gt;"}[h]});b=b.replace(/\r?\n/g,"<br />");b=b.replace(/\[code\s*(?:=\s*([^\]]+?))?\]([\s\S]*?)\[\/code\]/ig,function(h){n++;p[n]=h;return"[\tubbcodeplace_"+n+"\t]"});b=b.replace(/\[(\/?)(b|u|i|s|sup|sub)\]/ig,"<$1$2>");b=b.replace(/\[color\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,'<font color="$1">');b=b.replace(/\[size\s*=\s*(\d+?)\s*\]/ig,
'<font size="$1">');b=b.replace(/\[font\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,'<font face="$1">');b=b.replace(/\[\/(color|size|font)\]/ig,"</font>");b=b.replace(/\[back\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,'<span style="background-color:$1;">');b=b.replace(/\[\/back\]/ig,"</span>");for(f=0;f<3;f++)b=b.replace(/\[align\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\](((?!\[align(?:\s+[^\]]+)?\])[\s\S])*?)\[\/align\]/ig,'<p align="$1">$2</p>');b=b.replace(/\[img\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/img\]/ig,
'<img src="$1" alt="" />');b=b.replace(/\[img\s*=([^,\]]*)(?:\s*,\s*(\d*%?)\s*,\s*(\d*%?)\s*)?(?:,?\s*(\w+))?\s*\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*)?\s*\[\/img\]/ig,function(h,i,a,k,m,g){h='<img src="'+g+'" alt="'+i+'"';m=m?m:!o(a)?a:"";if(o(a))h+=' width="'+a+'"';if(o(k))h+=' height="'+k+'"';if(m)h+=' align="'+m+'"';h+=" />";return h});b=b.replace(/\[emot\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\/\]/ig,'<img emot="$1" />');b=b.replace(/\[url\]\s*(((?!")[\s\S])*?)(?:"[\s\S]*?)?\s*\[\/url\]/ig,'<a href="$1">$1</a>');
b=b.replace(/\[url\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]\s*([\s\S]*?)\s*\[\/url\]/ig,'<a href="$1">$2</a>');b=b.replace(/\[email\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/email\]/ig,'<a href="mailto:$1">$1</a>');b=b.replace(/\[email\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]\s*([\s\S]+?)\s*\[\/email\]/ig,'<a href="mailto:$1">$2</a>');b=b.replace(/\[quote\]([\s\S]*?)\[\/quote\]/ig,"<blockquote>$1</blockquote>");b=b.replace(/\[flash\s*(?:=\s*(\d+)\s*,\s*(\d+)\s*)?\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/flash\]/ig,
function(h,i,a,k){i||(i=480);a||(a=400);return'<embed type="application/x-shockwave-flash" src="'+k+'" wmode="opaque" quality="high" bgcolor="#ffffff" menu="false" play="true" loop="true" width="'+i+'" height="'+a+'"/>'});b=b.replace(/\[media\s*(?:=\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+)\s*)?)?\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/media\]/ig,function(h,i,a,k,m){i||(i=480);a||(a=400);return'<embed type="application/x-mplayer2" src="'+m+'" enablecontextmenu="false" autostart="'+(k=="1"?"true":"false")+
'" width="'+i+'" height="'+a+'"/>'});b=b.replace(/\[table\s*(?:=\s*(\d{1,4}%?)\s*(?:,\s*([^\]"]+)(?:"[^\]]*?)?)?)?\s*\]/ig,function(h,i,a){h="<table";if(i)h+=' width="'+i+'"';if(a)h+=' bgcolor="'+a+'"';return h+">"});b=b.replace(/\[tr\s*(?:=\s*([^\]"]+?)(?:"[^\]]*?)?)?\s*\]/ig,function(h,i){return"<tr"+(i?' bgcolor="'+i+'"':"")+">"});b=b.replace(/\[td\s*(?:=\s*(\d{1,2})\s*,\s*(\d{1,2})\s*(?:,\s*(\d{1,4}%?))?)?\s*\]/ig,function(h,i,a,k){return"<td"+(i>1?' colspan="'+i+'"':"")+(a>1?' rowspan="'+a+'"':
"")+(k?' width="'+k+'"':"")+">"});b=b.replace(/\[\/(table|tr|td)\]/ig,"</$1>");b=b.replace(/\[\*\]((?:(?!\[\*\]|\[\/list\]|\[list\s*(?:=[^\]]+)?\])[\s\S])+)/ig,"<li>$1</li>");b=b.replace(/\[list\s*(?:=\s*([^\]"]+?)(?:"[^\]]*?)?)?\s*\]/ig,function(h,i){var a="<ul";if(i)a+=' type="'+i+'"';return a+">"});b=b.replace(/\[\/list\]/ig,"</ul>");for(f=1;f<=n;f++)b=b.replace("[\tubbcodeplace_"+f+"\t]",p[f]);return b=b.replace(/(^|<\/?\w+(?:\s+[^>]*?)?>)([^<$]+)/ig,function(h,i,a){return i+a.replace(/[\t ]/g,
function(k){return{"\t":"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"," ":"&nbsp;"}[k]})})}
function html2ubb(f){function o(g){var c;if(c=g.match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i)){for(g=(c[1]*65536+c[2]*256+c[3]*1).toString(16);g.length<6;)g="0"+g;g="#"+g}return g=g.replace(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3")}var b={"xx-small":1,"8pt":1,"x-small":2,"10pt":2,small:3,"12pt":3,medium:4,"14pt":4,large:5,"18pt":5,"x-large":6,"24pt":6,"xx-large":7,"36pt":7},p=/\s+src\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i,n=/\s+width\s*=\s*(["']?)\s*(\d+(?:\.\d+)?%?)\s*\1(\s|$)/i,
h=/\s+height\s*=\s*(["']?)\s*(\d+(?:\.\d+)?%?)\s*\1(\s|$)/i,i=/(?:background|background-color|bgcolor)\s*[:=]\s*(["']?)\s*((rgb\s*\(\s*\d{1,3}%?,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*\))|(#[0-9a-f]{3,6})|([a-z]{1,20}))\s*\1/i,a=String(f),k=[],m=0;a=a.replace(/\s*\r?\n\s*/g,"");a=a.replace(/<(script|style)(\s+[^>]*?)?>[\s\S]*?<\/\1>/ig,"");a=a.replace(/<!--[\s\S]*?--\>/ig,"");a=a.replace(/<br\s*?\/?>/ig,"\r\n");a=a.replace(/\[code\s*(=\s*([^\]]+?))?\]([\s\S]*?)\[\/code\]/ig,function(g){m++;k[m]=g;return"[\tubbcodeplace_"+
m+"\t]"});a=a.replace(/<(\/?)(b|u|i|s)(\s+[^>]*?)?>/ig,"[$1$2]");a=a.replace(/<(\/?)strong(\s+[^>]*?)?>/ig,"[$1b]");a=a.replace(/<(\/?)em(\s+[^>]*?)?>/ig,"[$1i]");a=a.replace(/<(\/?)(strike|del)(\s+[^>]*?)?>/ig,"[$1s]");a=a.replace(/<(\/?)(sup|sub)(\s+[^>]*?)?>/ig,"[$1$2]");for(f=0;f<3;f++)a=a.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*(?:font-family|font-size|color|background|background-color)\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,
function(g,c,d,e){g=d.match(/(?:^|;)\s*font-family\s*:\s*([^;]+)/i);c=d.match(/(?:^|;)\s*font-size\s*:\s*([^;]+)/i);var j=d.match(/(?:^|;)\s*color\s*:\s*([^;]+)/i);d=d.match(/(?:^|;)\s*(?:background|background-color)\s*:\s*([^;]+)/i);e=e;if(g)e="[font="+g[1]+"]"+e+"[/font]";if(c)if(c=b[c[1].toLowerCase()])e="[size="+c+"]"+e+"[/size]";if(j)e="[color="+o(j[1])+"]"+e+"[/color]";if(d)e="[back="+o(d[1])+"]"+e+"[/back]";return e});for(f=0;f<3;f++)a=a.replace(/<(div|p)(?:\s+[^>]*?)?[\s"';]\s*(?:text-)?align\s*[=:]\s*(["']?)\s*(left|center|right)\s*\2[^>]*>(((?!<\1(\s+[^>]*?)?>)[\s\S])+?)<\/\1>/ig,
"[align=$3]$4[/align]");for(f=0;f<3;f++)a=a.replace(/<(center)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,"[align=center]$2[/align]");for(f=0;f<3;f++)a=a.replace(/<(p|div)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*text-align\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,function(){});a=a.replace(/<a(?:\s+[^>]*?)?\s+href=(["'])\s*(.+?)\s*\1[^>]*>\s*([\s\S]*?)\s*<\/a>/ig,
function(g,c,d,e){if(!(d&&e))return"";g="url";if(d.match(/^mailto:/i)){g="email";d=d.replace(/mailto:(.+?)/i,"$1")}c="["+g;if(d!=e)c+="="+d;return c+"]"+e+"[/"+g+"]"});a=a.replace(/<img(\s+[^>]*?)\/?>/ig,function(g,c){var d=c.match(/\s+emot\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i);if(d)return"[emot="+d[2]+"/]";d=c.match(p);var e=c.match(/\s+alt\s*=\s*(["']?)\s*(.*?)\s*\1(\s|$)/i),j=c.match(n),l=c.match(h),q=c.match(/\s+align\s*=\s*(["']?)\s*(\w+)\s*\1(\s|$)/i),r="[img",s="";if(!d)return"";s+=e[2];if(j||
l)s+=","+(j?j[2]:"")+","+(l?l[2]:"");if(q)s+=","+q[2];if(s)r+="="+s;r+="]"+d[2]+"[/img]";return r});a=a.replace(/<blockquote(?:\s+[^>]*?)?>([\s\S]+?)<\/blockquote>/ig,"[quote]$1[/quote]");a=a.replace(/<embed((?:\s+[^>]*?)?(?:\s+type\s*=\s*"\s*application\/x-shockwave-flash\s*"|\s+classid\s*=\s*"\s*clsid:d27cdb6e-ae6d-11cf-96b8-4445535400000\s*")[^>]*?)\/>/ig,function(g,c){var d=c.match(p),e=c.match(n),j=c.match(h),l="[flash";if(!d)return"";if(e&&j)l+="="+e[2]+","+j[2];l+="]"+d[2];return l+"[/flash]"});
a=a.replace(/<embed((?:\s+[^>]*?)?(?:\s+type\s*=\s*"\s*application\/x-mplayer2\s*"|\s+classid\s*=\s*"\s*clsid:6bf52a52-394a-11d3-b153-00c04f79faa6\s*")[^>]*?)\/>/ig,function(g,c){var d=c.match(p),e=c.match(n),j=c.match(h),l=c.match(/\s+autostart\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i),q="[media",r="0";if(!d)return"";if(l)if(l[2]=="true")r="1";if(e&&j)q+="="+e[2]+","+j[2]+","+r;q+="]"+d[2];return q+"[/media]"});a=a.replace(/<table(\s+[^>]*?)?>/ig,function(g,c){var d="[table";if(c){var e=c.match(n),j=c.match(i);
if(e){d+="="+e[2];if(j)d+=","+j[2]}}return d+"]"});a=a.replace(/<tr(\s+[^>]*?)?>/ig,function(g,c){var d="[tr";if(c){var e=c.match(i);if(e)d+="="+e[2]}return d+"]"});a=a.replace(/<(?:th|td)(\s+[^>]*?)?>/ig,function(g,c){var d="[td";if(c){var e=c.match(/\s+colspan\s*=\s*(["']?)\s*(\d+)\s*\1(\s|$)/i),j=c.match(/\s+rowspan\s*=\s*(["']?)\s*(\d+)\s*\1(\s|$)/i),l=c.match(n);e=e?e[2]:1;j=j?j[2]:1;if(e>1||j>1||l)d+="="+e+","+j;if(l)d+=","+l[2]}return d+"]"});a=a.replace(/<\/(table|tr)>/ig,"[/$1]");a=a.replace(/<\/(th|td)>/ig,
"[/td]");a=a.replace(/<ul(\s+[^>]*?)?>/ig,function(g,c){var d;if(c)d=c.match(/\s+type\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i);return"[list"+(d?"="+d[2]:"")+"]"});a=a.replace(/<ol(\s+[^>]*?)?>/ig,"[list=1]");a=a.replace(/<li(\s+[^>]*?)?>/ig,"[*]");a=a.replace(/<\/li>/ig,"");a=a.replace(/<\/(ul|ol)>/ig,"[/list]");a=a.replace(/<h([1-6])(\s+[^>]*?)?>/ig,function(g,c){return"\r\n\r\n[size="+(7-c)+"][b]"});a=a.replace(/<\/h[1-6]>/ig,"[/b][/size]\r\n\r\n");a=a.replace(/<address(\s+[^>]*?)?>/ig,"\r\n[i]");a=
a.replace(/<\/address>/ig,"[i]\r\n");for(f=0;f<3;f++)a=a.replace(/<(p)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,"\r\n\r\n$2\r\n\r\n");for(f=0;f<3;f++)a=a.replace(/<(div)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,"\r\n$2\r\n");a=a.replace(/((\s|&nbsp;)*\r?\n){3,}/g,
"\r\n\r\n");a=a.replace(/^((\s|&nbsp;)*\r?\n)+/g,"");a=a.replace(/((\s|&nbsp;)*\r?\n)+$/g,"");for(f=1;f<=m;f++)a=a.replace("[\tubbcodeplace_"+f+"\t]",k[f]);a=a.replace(/<[^<>]+?>/g,"");a=a.replace(/&lt;/ig,"<");a=a.replace(/&gt;/ig,">");a=a.replace(/&nbsp;/ig," ");return a=a.replace(/&amp;/ig,"&")};
